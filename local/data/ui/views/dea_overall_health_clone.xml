<dashboard>
  <label>DEA Overall Health Clone</label>
  <searchTemplate>index=$prod$ host="*" mbean_domain="org.cloudfoundry" mbean_property_deployment="cf-deployment" mbean_property_job="DEA" | eval job_and_index = jvmDescription + "_" + mbean_property_job + "_" + mbean_property_index | fields job_and_index "dea_registry_resuming[stack=lucid64]" "dea_registry_crashed[stack=lucid64]" "dea_registry_starting[stack=lucid64]" "dea_registry_born[stack=lucid64]" "dea_registry_deleted[stack=lucid64]" "dea_registry_stopped[stack=lucid64]" "dea_registry_running[stack=lucid64]" "dea_registry_stopping[stack=lucid64]" "available_memory_ratio[stack=lucid64]" "available_disk_ratio[stack=lucid64]" "log_count[level=error,stack=lucid64]" "log_count[level=warn,stack=lucid64]" "log_count[level=fatal,stack=lucid64]" "reservable_stagers[stack=lucid64]" "can_stage[stack=lucid64]" "cpu_load_avg[stack=lucid64]" "warden_request_count[stack=lucid64]" "total_warden_response_time_in_ms[stack=lucid64]"</searchTemplate>
  <earliestTime>$time.earliest$</earliestTime>
  <latestTime>$time.latest$</latestTime>
  <row>
    <panel>
      <single>
        <title>Reservable Stagers - 5m</title>
        <search>
          <query>index=jmx_prod_*st
host="*"
mbean_domain="org.cloudfoundry"
mbean_property_deployment="cf-deployment"
mbean_property_job="DEA"
| eval job_and_index = jvmDescription + "_" + mbean_property_job + "_" + mbean_property_index 
| rename "reservable_stagers[stack=lucid64]" as reservable_stagers_stack
| eval reservable_stagers=if(isnotnull(reservable_stagers_stack), reservable_stagers_stack, reservable_stagers)
| fields reservable_stagers, job_and_index
| bucket _time span=5min
| stats latest(reservable_stagers) as reservable_stagers by _time, job_and_index
| stats sum(reservable_stagers) by _time</query>
          <earliest>rt-5m</earliest>
          <latest>rt</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="numberPrecision">0</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
        <option name="linkView">search</option>
        <option name="afterLabel">GB</option>
        <option name="rangeColors">["0x65a637","0x6db7c6","0xf7bc38","0xf58f39","0xd93f3c"]</option>
        <option name="rangeValues">[0,30,70,100]</option>
        <option name="trendInterval">auto</option>
      </single>
    </panel>
    <panel>
      <chart>
        <title>Reservable Stagers -1h</title>
        <search>
          <query>index=jmx_prod_*st
host="*"
mbean_domain="org.cloudfoundry"
mbean_property_deployment="cf-deployment"
mbean_property_job="DEA"
| eval job_and_index = jvmDescription + "_" + mbean_property_job + "_" + mbean_property_index 
| rename "reservable_stagers[stack=lucid64]" as reservable_stagers_stack
| eval reservable_stagers=if(isnotnull(reservable_stagers_stack), reservable_stagers_stack, reservable_stagers)
| fields reservable_stagers, job_and_index
| bucket _time span=5min
| stats latest(reservable_stagers) as reservable_stagers by _time, job_and_index
| stats sum(reservable_stagers) by _time</query>
          <earliest>rt-1h</earliest>
          <latest>rt</latest>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.minimumNumber">0</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.axisTitleY.text">GB</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <single>
        <title>Mem Free Bytes - 5m avg</title>
        <search>
          <query>index=jmx_prod_*st
host="*"
mbean_domain="org.cloudfoundry"
mbean_property_deployment="cf-deployment"
mbean_property_job="DEA"
| eval job_and_index = jvmDescription + "_" + mbean_property_job + "_" + mbean_property_index 
| rename "mem_free_bytes[stack=lucid64]" as mem_free_bytes_stack
| eval mem_free_bytes=if(isnotnull(mem_free_bytes_stack), mem_free_bytes_stack, mem_free_bytes)
| fields mem_free_bytes, job_and_index
| bucket _time span=5min
| eval mem_free_gb=mem_free_bytes/1000000000
| stats latest(mem_free_gb) as mem_free_gb by _time, job_and_index
| stats sum(mem_free_gb) by _time</query>
          <earliest>rt-5m</earliest>
          <latest>rt</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="numberPrecision">0</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
        <option name="linkView">search</option>
        <option name="afterLabel">GB</option>
        <option name="rangeColors">["0x65a637","0x6db7c6","0xf7bc38","0xf58f39","0xd93f3c"]</option>
        <option name="rangeValues">[0,30,70,100]</option>
        <option name="trendInterval">auto</option>
      </single>
    </panel>
    <panel>
      <chart>
        <title>Mem Free Bytes - 1h</title>
        <search>
          <query>index=jmx_prod_*st
host="*"
mbean_domain="org.cloudfoundry"
mbean_property_deployment="cf-deployment"
mbean_property_job="DEA"
| eval job_and_index = jvmDescription + "_" + mbean_property_job + "_" + mbean_property_index 
| rename "mem_free_bytes[stack=lucid64]" as mem_free_bytes_stack
| eval mem_free_bytes=if(isnotnull(mem_free_bytes_stack), mem_free_bytes_stack, mem_free_bytes)
| fields mem_free_bytes, job_and_index
| bucket _time span=5min
| eval mem_free_gb=mem_free_bytes/1000000000
| stats latest(mem_free_gb) as mem_free_gb by _time, job_and_index
| stats sum(mem_free_gb) by _time</query>
          <earliest>rt-1h</earliest>
          <latest>rt</latest>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <single>
        <title>Hours Since Last DEA Start</title>
        <search>
          <query>index=jmx_prod_*st
host="*"
mbean_domain="org.cloudfoundry"
mbean_property_deployment="cf-deployment"
mbean_property_job="DEA"
| eval job_and_index = jvmDescription + "_" + mbean_property_job + "_" + mbean_property_index 
| rename "uptime_in_seconds[stack=lucid64]" as uptime_in_seconds_stack
| eval uptime_in_seconds=if(isnotnull(uptime_in_seconds_stack), uptime_in_seconds_stack, uptime_in_seconds)
| fields uptime_in_seconds, job_and_index
| bucket _time span=5min
| eval uptime_in_hours=uptime_in_seconds/3600
| stats latest(uptime_in_hours) as uptime_in_hours by _time, job_and_index
| stats min(uptime_in_hours) by _time</query>
          <earliest>rt-5m</earliest>
          <latest>rt</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="numberPrecision">0</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
        <option name="linkView">search</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Percent of DEAs with more than 4 GB free RAM</title>
        <search>
          <query>index=jmx_prod_*st host="*" mbean_domain="org.cloudfoundry" mbean_property_deployment="cf-deployment" mbean_property_job="DEA" | eval job_and_index = jvmDescription + "_" + mbean_property_job + "_" + mbean_property_index  | rename "reservable_stagers[stack=lucid64]" as reservable_stagers_stack | eval reservable_stagers=if(isnotnull(reservable_stagers_stack), reservable_stagers_stack, reservable_stagers) | bucket _time span=5min | stats latest(reservable_stagers) as Stagers by _time, job_and_index | eval has_enough_stagers=if(Stagers&gt;4,"true","false") |stats count(eval(has_enough_stagers="true")) as Stagers, count as Total by _time | eval percentage=100*(Stagers/Total) | fields percentage</query>
          <earliest>rt-5m</earliest>
          <latest>rt</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="afterLabel">%</option>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x65a637","0x6db7c6","0xf7bc38","0xf58f39","0xd93f3c"]</option>
        <option name="rangeValues">[0,30,70,100]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="trendInterval">auto</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
        <option name="linkView">search</option>
      </single>
    </panel>
  </row>
</dashboard>